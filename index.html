<!DOCTYPE html>
<html lang="en" class="bg-gray-50 dark:bg-gray-900">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Product Catalog Tool</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Heroicons CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <script>
    // Tailwind config for dark mode
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'status-idea': '#fbbf24', // amber-400
            'status-planned': '#60a5fa', // blue-400
            'status-inprogress': '#f59e42', // orange-400
            'status-deployed': '#34d399', // green-400
            'status-retired': '#9ca3af', // gray-400
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
<!-- ================= HEADER & TOOLBAR ================= -->
<header class="sticky top-0 z-20 bg-white/80 dark:bg-gray-800/80 shadow backdrop-blur flex flex-col gap-2 p-4">
  <div class="flex flex-wrap items-center justify-between gap-2">
    <h1 class="text-2xl font-bold">Visual Product Catalog Tool</h1>
    <div class="flex gap-2 items-center">
      <button id="themeToggleBtn" title="Toggle theme" class="rounded-full p-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition">
        <i id="themeIcon" class="fa-regular fa-moon"></i>
      </button>
      <button id="exportJsonBtn" class="px-3 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-export"></i> Export JSON</button>
      <button id="importJsonBtn" class="px-3 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-import"></i> Import JSON</button>
      <button id="exportCsvBtn" class="px-3 py-1 rounded bg-green-500 hover:bg-green-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-csv"></i> Export CSV</button>
      <button id="importCsvBtn" class="px-3 py-1 rounded bg-green-500 hover:bg-green-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-import"></i> Import CSV</button>
      <input type="file" id="hiddenFileInput" class="hidden" accept=".json,.csv" />
    </div>
  </div>
  <div class="flex flex-wrap gap-2 items-center mt-2">
    <button id="filterPanelToggle" class="flex items-center gap-1 px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm"><i class="fa-solid fa-filter"></i> Filters</button>
    <input id="searchInput" type="text" placeholder="Search by title, tags, or owners..." class="flex-1 px-3 py-2 rounded border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"/>
    <div id="analyticsSection" class="flex gap-2 ml-auto"></div>
  </div>
</header>
<!-- ================= FILTER PANEL ================= -->
<aside id="filterPanel" class="fixed left-0 top-20 w-full max-w-xs z-30 bg-white dark:bg-gray-800 shadow-lg rounded-r-xl p-4 transition-transform duration-300 -translate-x-full">
  <div class="flex justify-between items-center mb-2">
    <h2 class="font-semibold text-lg">Filters</h2>
    <button id="closeFilterPanel" class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Status</label>
    <select id="filterStatus" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
      <option value="">All</option>
      <option value="Idea">Idea</option>
      <option value="Planned">Planned</option>
      <option value="In Progress">In Progress</option>
      <option value="Deployed">Deployed</option>
      <option value="Retired">Retired</option>
    </select>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Domain</label>
    <select id="filterDomain" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
      <option value="">All</option>
      <option value="Inventory">Inventory</option>
      <option value="Billing">Billing</option>
      <option value="Network Management">Network Management</option>
      <option value="Other">Other</option>
    </select>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Tags</label>
    <input id="filterTags" type="text" placeholder="Comma-separated tags" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
  </div>
  <button id="applyFiltersBtn" class="w-full py-2 rounded bg-blue-500 hover:bg-blue-600 text-white font-semibold">Apply Filters</button>
</aside>
<!-- ================= MAIN CONTENT ================= -->
<main class="flex-1 p-4 pt-6 max-w-7xl mx-auto w-full">
  <!-- ============== Capability Map (Grid) ============== -->
  <div id="capabilityGrid" class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
  <!-- ============== Empty State ============== -->
  <div id="emptyState" class="hidden flex flex-col items-center justify-center py-24 text-gray-400">
    <i class="fa-solid fa-box-open text-6xl mb-4"></i>
    <p class="text-lg">No capabilities found. Click the + button to add one!</p>
  </div>
</main>
<!-- ================= Floating Add Button ================= -->
<button id="addCapabilityBtn" class="fixed bottom-6 right-6 z-40 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg w-16 h-16 flex items-center justify-center text-3xl focus:outline-none">
  <i class="fa-solid fa-plus"></i>
</button>
<!-- ================= Capability Details Modal ================= -->
<div id="capabilityDetailsModal" class="fixed inset-0 z-50 bg-black/40 hidden flex items-center justify-center">
  <div class="bg-white dark:bg-gray-900 rounded-lg shadow-lg max-w-lg w-full p-6 relative">
    <button id="closeDetailsModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-900 dark:hover:text-gray-100"><i class="fa-solid fa-xmark text-2xl"></i></button>
    <div id="capabilityDetailsContent"></div>
  </div>
</div>
<!-- ================= Add/Edit Capability Modal ================= -->
<div id="capabilityFormModal" class="fixed inset-0 z-50 bg-black/40 hidden flex items-center justify-center">
  <div class="bg-white dark:bg-gray-900 rounded-lg shadow-lg max-w-md w-full p-6 relative">
    <button id="closeFormModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-900 dark:hover:text-gray-100"><i class="fa-solid fa-xmark text-2xl"></i></button>
    <form id="capabilityForm" autocomplete="off" class="space-y-4">
      <h2 id="formTitle" class="text-xl font-semibold mb-2">Add Capability</h2>
      <div>
        <label class="block font-semibold mb-1">Title <span class="text-red-500">*</span></label>
        <input name="title" type="text" required minlength="3" maxlength="100" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
        <div class="text-xs text-gray-400 mt-1">3-100 characters</div>
      </div>
      <div>
        <label class="block font-semibold mb-1">Description <span class="text-red-500">*</span></label>
        <textarea name="description" required minlength="5" maxlength="500" rows="2" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"></textarea>
        <div class="text-xs text-gray-400 mt-1">5-500 characters</div>
      </div>
      <div>
        <label class="block font-semibold mb-1">Status</label>
        <select name="status" required class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
          <option value="Idea">Idea</option>
          <option value="Planned">Planned</option>
          <option value="In Progress">In Progress</option>
          <option value="Deployed">Deployed</option>
          <option value="Retired">Retired</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold mb-1">Domain</label>
        <select name="domain" required class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
          <option value="Inventory">Inventory</option>
          <option value="Billing">Billing</option>
          <option value="Network Management">Network Management</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold mb-1">Tags</label>
        <input name="tags" type="text" placeholder="Comma-separated tags" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Owners</label>
        <input name="owners" type="text" placeholder="Business, Technical" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Priority</label>
        <select name="priority" required class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
      </div>
      <button type="submit" class="w-full py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold">Save</button>
    </form>
  </div>
</div>
<!-- ================= Toast Notification ================= -->
<div id="toast" class="fixed bottom-24 right-6 z-50 hidden px-4 py-2 rounded bg-gray-800 text-white shadow-lg"></div>
<!-- ================= MAIN JS ================= -->
<script>
// =================== DATA MODEL & STORAGE ===================
const STORAGE_KEY = 'product_catalog_capabilities_v1';
let capabilities = [];
let filters = { status: '', domain: '', tags: '' };
let searchQuery = '';
let editingId = null;

// ========== Utility Functions ==========
function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}
function nowISO() {
  return new Date().toISOString();
}
function formatDate(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
}
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.remove('hidden');
  setTimeout(() => toast.classList.add('hidden'), 2500);
}
function saveToStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(capabilities));
}
function loadFromStorage() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (data) capabilities = JSON.parse(data);
}
// ========== Status Badge Color ==========
function statusBadgeColor(status) {
  switch(status) {
    case 'Idea': return 'bg-status-idea text-white';
    case 'Planned': return 'bg-status-planned text-white';
    case 'In Progress': return 'bg-status-inprogress text-white';
    case 'Deployed': return 'bg-status-deployed text-white';
    case 'Retired': return 'bg-status-retired text-gray-900 dark:text-gray-100';
    default: return 'bg-gray-400 text-white';
  }
}
// ========== Priority Color ==========
function priorityColor(priority) {
  switch(priority) {
    case 'High': return 'text-red-600 font-bold';
    case 'Medium': return 'text-yellow-600 font-semibold';
    case 'Low': return 'text-green-600';
    default: return '';
  }
}
// ========== Tag Color ==========
function tagColor(tag) {
  // Simple hash for color
  const colors = ['bg-blue-100 text-blue-700', 'bg-green-100 text-green-700', 'bg-yellow-100 text-yellow-700', 'bg-pink-100 text-pink-700', 'bg-purple-100 text-purple-700', 'bg-gray-200 text-gray-700'];
  let hash = 0;
  for (let i = 0; i < tag.length; i++) hash = tag.charCodeAt(i) + ((hash << 5) - hash);
  return colors[Math.abs(hash) % colors.length];
}
// ========== Group Capabilities by Domain ==========
function groupByDomain(list) {
  const groups = {};
  for (const cap of list) {
    if (!groups[cap.domain]) groups[cap.domain] = [];
    groups[cap.domain].push(cap);
  }
  return groups;
}
// ========== Filter & Search ==========
function filterAndSearch(list) {
  return list.filter(cap => {
    // Status
    if (filters.status && cap.status !== filters.status) return false;
    // Domain
    if (filters.domain && cap.domain !== filters.domain) return false;
    // Tags
    if (filters.tags) {
      const tagsArr = filters.tags.split(',').map(t => t.trim().toLowerCase()).filter(Boolean);
      if (tagsArr.length && !tagsArr.some(tag => cap.tags.map(t => t.toLowerCase()).includes(tag))) return false;
    }
    // Search
    if (searchQuery) {
      const q = searchQuery.toLowerCase();
      if (!cap.title.toLowerCase().includes(q)
        && !cap.tags.join(',').toLowerCase().includes(q)
        && !cap.owners.join(',').toLowerCase().includes(q)) return false;
    }
    return true;
  });
}
// =================== RENDER FUNCTIONS ===================
function renderAnalytics() {
  const statusList = ['Idea','Planned','In Progress','Deployed','Retired'];
  const counts = {};
  for (const s of statusList) counts[s] = 0;
  for (const cap of capabilities) counts[cap.status]++;
  let html = '';
  for (const s of statusList) {
    html += `<span class="inline-flex items-center gap-1 px-2 py-1 rounded ${statusBadgeColor(s)} text-xs font-semibold">${s}: ${counts[s]}</span>`;
  }
  document.getElementById('analyticsSection').innerHTML = html;
}
function renderGrid() {
  const grid = document.getElementById('capabilityGrid');
  const empty = document.getElementById('emptyState');
  const filtered = filterAndSearch(capabilities);
  if (!filtered.length) {
    grid.innerHTML = '';
    empty.classList.remove('hidden');
    return;
  }
  empty.classList.add('hidden');
  const grouped = groupByDomain(filtered);
  let html = '';
  for (const domain in grouped) {
    html += `<div class="col-span-full mt-6 mb-1 flex items-center gap-2"><span class="font-bold text-lg">${domain}</span></div>`;
    for (const cap of grouped[domain]) {
      html += renderCard(cap);
    }
  }
  grid.innerHTML = html;
}
// <!-- Capability Card -->
function renderCard(cap) {
  return `<div class="bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition p-4 flex flex-col gap-2 cursor-pointer group relative border border-gray-100 dark:border-gray-700" onclick="showDetails('${cap.id}')">
    <div class="flex items-center justify-between">
      <span class="font-semibold text-lg">${cap.title}</span>
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded ${statusBadgeColor(cap.status)} text-xs font-semibold">${cap.status}</span>
    </div>
    <div class="flex flex-wrap gap-1 mb-2">${cap.tags.map(tag => `<span class="px-2 py-0.5 rounded ${tagColor(tag)} text-xs">${tag}</span>`).join('')}</div>
    <div class="flex items-center gap-2 text-xs text-gray-500">
      <span><i class="fa-solid fa-user"></i> ${cap.owners.join(', ')}</span>
      <span><i class="fa-solid fa-clock"></i> ${formatDate(cap.lastUpdated)}</span>
    </div>
    <div class="flex items-center gap-2 mt-2">
      <span class="${priorityColor(cap.priority)} text-xs">${cap.priority} Priority</span>
    </div>
    <div class="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition">
      <button onclick="event.stopPropagation();editCapability('${cap.id}')" class="p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900"><i class="fa-solid fa-pen-to-square text-blue-600"></i></button>
      <button onclick="event.stopPropagation();deleteCapability('${cap.id}')" class="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900"><i class="fa-solid fa-trash text-red-600"></i></button>
    </div>
  </div>`;
}
// ========== Capability Details Modal ==========
function renderDetails(cap) {
  return `<div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="text-2xl font-bold">${cap.title}</h3>
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded ${statusBadgeColor(cap.status)} text-xs font-semibold">${cap.status}</span>
    </div>
    <div class="mb-2 text-gray-700 dark:text-gray-200">${cap.description}</div>
    <div class="flex flex-wrap gap-1 mb-2">${cap.tags.map(tag => `<span class="px-2 py-0.5 rounded ${tagColor(tag)} text-xs">${tag}</span>`).join('')}</div>
    <div class="flex items-center gap-2 text-sm mb-2">
      <span><b>Domain:</b> ${cap.domain}</span>
      <span><b>Priority:</b> <span class="${priorityColor(cap.priority)}">${cap.priority}</span></span>
    </div>
    <div class="flex items-center gap-2 text-sm mb-2">
      <span><b>Owners:</b> ${cap.owners.join(', ')}</span>
    </div>
    <div class="text-xs text-gray-500 mb-2">Last updated: ${formatDate(cap.lastUpdated)}</div>
    <div class="flex gap-2 mt-4">
      <button onclick="editCapability('${cap.id}',true)" class="px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold"><i class="fa-solid fa-pen-to-square"></i> Edit</button>
      <button onclick="deleteCapability('${cap.id}',true)" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700 text-white font-semibold"><i class="fa-solid fa-trash"></i> Delete</button>
    </div>
  </div>`;
}
// =================== CRUD LOGIC ===================
function addCapability(cap) {
  capabilities.push(cap);
  saveToStorage();
  renderGrid();
  renderAnalytics();
  showToast('Capability added!');
}
function updateCapability(id, updated) {
  const idx = capabilities.findIndex(c => c.id === id);
  if (idx > -1) {
    capabilities[idx] = { ...capabilities[idx], ...updated, lastUpdated: nowISO() };
    saveToStorage();
    renderGrid();
    renderAnalytics();
    showToast('Capability updated!');
  }
}
function removeCapability(id) {
  capabilities = capabilities.filter(c => c.id !== id);
  saveToStorage();
  renderGrid();
  renderAnalytics();
  showToast('Capability deleted!');
}
// =================== MODAL HANDLING ===================
function showFormModal(editingCap = null) {
  document.getElementById('capabilityFormModal').classList.remove('hidden');
  document.body.classList.add('overflow-hidden');
  const form = document.getElementById('capabilityForm');
  form.reset();
  editingId = null;
  document.getElementById('formTitle').textContent = editingCap ? 'Edit Capability' : 'Add Capability';
  if (editingCap) {
    editingId = editingCap.id;
    form.title.value = editingCap.title;
    form.description.value = editingCap.description;
    form.status.value = editingCap.status;
    form.domain.value = editingCap.domain;
    form.tags.value = editingCap.tags.join(', ');
    form.owners.value = editingCap.owners.join(', ');
    form.priority.value = editingCap.priority;
  }
}
function closeFormModal() {
  document.getElementById('capabilityFormModal').classList.add('hidden');
  document.body.classList.remove('overflow-hidden');
  editingId = null;
}
function showDetails(id) {
  const cap = capabilities.find(c => c.id === id);
  if (!cap) return;
  document.getElementById('capabilityDetailsModal').classList.remove('hidden');
  document.body.classList.add('overflow-hidden');
  document.getElementById('capabilityDetailsContent').innerHTML = renderDetails(cap);
}
function closeDetailsModal() {
  document.getElementById('capabilityDetailsModal').classList.add('hidden');
  document.body.classList.remove('overflow-hidden');
}
// ========== Edit/Delete from Card or Modal ==========
function editCapability(id, fromDetails = false) {
  const cap = capabilities.find(c => c.id === id);
  if (!cap) return;
  if (fromDetails) closeDetailsModal();
  showFormModal(cap);
}
function deleteCapability(id, fromDetails = false) {
  if (!confirm('Are you sure you want to delete this capability?')) return;
  if (fromDetails) closeDetailsModal();
  removeCapability(id);
}
// =================== FORM SUBMISSION ===================
document.getElementById('capabilityForm').onsubmit = function(e) {
  e.preventDefault();
  const form = e.target;
  const cap = {
    id: editingId || uuidv4(),
    title: form.title.value.trim(),
    description: form.description.value.trim(),
    status: form.status.value,
    domain: form.domain.value,
    tags: form.tags.value.split(',').map(t => t.trim()).filter(Boolean),
    owners: form.owners.value.split(',').map(t => t.trim()).filter(Boolean),
    lastUpdated: nowISO(),
    priority: form.priority.value
  };
  if (!cap.title || !cap.description) {
    showToast('Title and Description are required.');
    return;
  }
  if (editingId) {
    updateCapability(editingId, cap);
  } else {
    addCapability(cap);
  }
  closeFormModal();
};
// =================== EVENT LISTENERS ===================
document.getElementById('addCapabilityBtn').onclick = () => showFormModal();
document.getElementById('closeFormModal').onclick = closeFormModal;
document.getElementById('closeDetailsModal').onclick = closeDetailsModal;
document.getElementById('filterPanelToggle').onclick = () => {
  document.getElementById('filterPanel').classList.remove('-translate-x-full');
};
document.getElementById('closeFilterPanel').onclick = () => {
  document.getElementById('filterPanel').classList.add('-translate-x-full');
};
document.getElementById('applyFiltersBtn').onclick = () => {
  filters.status = document.getElementById('filterStatus').value;
  filters.domain = document.getElementById('filterDomain').value;
  filters.tags = document.getElementById('filterTags').value;
  renderGrid();
  document.getElementById('filterPanel').classList.add('-translate-x-full');
};
document.getElementById('searchInput').oninput = (e) => {
  searchQuery = e.target.value;
  renderGrid();
};
// ========== Theme Toggle ==========
function setTheme(dark) {
  const html = document.documentElement;
  if (dark) {
    html.classList.add('dark');
    localStorage.setItem('theme','dark');
    document.getElementById('themeIcon').className = 'fa-solid fa-sun';
  } else {
    html.classList.remove('dark');
    localStorage.setItem('theme','light');
    document.getElementById('themeIcon').className = 'fa-regular fa-moon';
  }
}
document.getElementById('themeToggleBtn').onclick = () => {
  const dark = !document.documentElement.classList.contains('dark');
  setTheme(dark);
};
(function initTheme() {
  const saved = localStorage.getItem('theme');
  setTheme(saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches));
})();
// ========== Export/Import JSON ==========
document.getElementById('exportJsonBtn').onclick = () => {
  const blob = new Blob([JSON.stringify(capabilities,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'product_catalog.json';
  a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('importJsonBtn').onclick = () => {
  document.getElementById('hiddenFileInput').accept = '.json';
  document.getElementById('hiddenFileInput').click();
};
document.getElementById('hiddenFileInput').onchange = function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const isJson = file.name.endsWith('.json');
  const isCsv = file.name.endsWith('.csv');
  const reader = new FileReader();
  reader.onload = function(evt) {
    try {
      if (isJson) {
        const arr = JSON.parse(evt.target.result);
        if (Array.isArray(arr)) {
          capabilities = arr;
          saveToStorage();
          renderGrid();
          renderAnalytics();
          showToast('Imported JSON!');
        } else throw new Error('Invalid JSON format');
      } else if (isCsv) {
        importFromCsv(evt.target.result);
      }
    } catch (err) {
      showToast('Import failed: ' + err.message);
    }
  };
  reader.readAsText(file);
  e.target.value = '';
};
// ========== Export/Import CSV ==========
document.getElementById('exportCsvBtn').onclick = () => {
  const headers = ['id','title','description','status','domain','tags','owners','lastUpdated','priority'];
  let csv = headers.join(',') + '\n';
  for (const cap of capabilities) {
    csv += [cap.id,cap.title.replace(/"/g,'""'),cap.description.replace(/"/g,'""'),cap.status,cap.domain,cap.tags.join('|'),cap.owners.join('|'),cap.lastUpdated,cap.priority].map(v => '"'+v.replace(/\n/g,' ')+'"').join(',') + '\n';
  }
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'product_catalog.csv';
  a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('importCsvBtn').onclick = () => {
  document.getElementById('hiddenFileInput').accept = '.csv';
  document.getElementById('hiddenFileInput').click();
};
function importFromCsv(text) {
  const lines = text.split(/\r?\n/).filter(Boolean);
  const headers = lines[0].split(',').map(h => h.replace(/"/g,''));
  const arr = [];
  for (let i = 1; i < lines.length; i++) {
    const values = parseCsvLine(lines[i]);
    if (values.length !== headers.length) continue;
    const obj = {};
    for (let j = 0; j < headers.length; j++) {
      let val = values[j].replace(/"/g,'');
      if (headers[j] === 'tags' || headers[j] === 'owners') val = val ? val.split('|').map(v=>v.trim()) : [];
      obj[headers[j]] = val;
    }
    arr.push(obj);
  }
  capabilities = arr;
  saveToStorage();
  renderGrid();
  renderAnalytics();
  showToast('Imported CSV!');
}
function parseCsvLine(line) {
  const regex = /\"((?:[^\"]|\")*)\"|([^,]+)/g;
  const out = [];
  let match;
  while ((match = regex.exec(line))) {
    out.push(match[1] !== undefined ? match[1] : match[2]);
  }
  return out;
}
// =================== INIT ===================
(function init() {
  loadFromStorage();
  renderGrid();
  renderAnalytics();
})();
</script>
</body>
</html>
