<!DOCTYPE html>
<html lang="en" class="bg-gray-50 dark:bg-gray-900">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Product Catalog Tool</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Heroicons CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <script>
    // Tailwind config for dark mode
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'status-idea': '#fbbf24', // amber-400
            'status-planned': '#60a5fa', // blue-400
            'status-inprogress': '#f59e42', // orange-400
            'status-deployed': '#34d399', // green-400
            'status-retired': '#9ca3af', // gray-400
          }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
<!-- ================= HEADER & TOOLBAR ================= -->
<header class="sticky top-0 z-20 bg-white/80 dark:bg-gray-800/80 shadow backdrop-blur flex flex-col gap-2 p-4">
  <div class="flex flex-wrap items-center justify-between gap-2">
    <h1 class="text-2xl font-bold">Visual Product Catalog Tool</h1>
    <div class="flex gap-2 items-center">
      <button id="themeToggleBtn" title="Toggle theme" class="rounded-full p-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition">
        <i id="themeIcon" class="fa-regular fa-moon"></i>
      </button>
      <button id="exportJsonBtn" class="px-3 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-export"></i> Export JSON</button>
      <button id="importJsonBtn" class="px-3 py-1 rounded bg-blue-500 hover:bg-blue-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-import"></i> Import JSON</button>
      <button id="exportCsvBtn" class="px-3 py-1 rounded bg-green-500 hover:bg-green-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-csv"></i> Export CSV</button>
      <button id="importCsvBtn" class="px-3 py-1 rounded bg-green-500 hover:bg-green-600 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-file-import"></i> Import CSV</button>
      <input type="file" id="hiddenFileInput" class="hidden" accept=".json,.csv" />
      <button id="changeDataModeBtn" class="px-3 py-1 rounded bg-gray-400 hover:bg-gray-500 text-white text-sm flex items-center gap-1"><i class="fa-solid fa-database"></i> Change Data Mode</button>
      <span id="dataModeIndicator" class="ml-2 px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-xs text-gray-800 dark:text-gray-200">Mode: ...</span>
    </div>
  </div>
  <div class="flex flex-wrap gap-2 items-center mt-2">
    <button id="filterPanelToggle" class="flex items-center gap-1 px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm"><i class="fa-solid fa-filter"></i> Filters</button>
    <button id="viewToggleBtn" class="flex items-center gap-1 px-2 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm">
      <i id="viewToggleIcon" class="fa-solid fa-table-cells"></i>
      <span id="viewToggleText">Grid View</span>
    </button>
    <input id="searchInput" type="text" placeholder="Search by title, tags, or owners..." class="flex-1 px-3 py-2 rounded border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"/>
    <div id="analyticsSection" class="flex gap-2 ml-auto"></div>
  </div>
</header>
<!-- ================= FILTER PANEL ================= -->
<aside id="filterPanel" class="fixed left-0 top-20 w-full max-w-xs z-30 bg-white dark:bg-gray-800 shadow-lg rounded-r-xl p-4 transition-transform duration-300 -translate-x-full">
  <div class="flex justify-between items-center mb-2">
    <h2 class="font-semibold text-lg">Filters</h2>
    <button id="closeFilterPanel" class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Status</label>
    <select id="filterStatus" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
      <option value="">All</option>
      <option value="Idea">Idea</option>
      <option value="Planned">Planned</option>
      <option value="In Progress">In Progress</option>
      <option value="Deployed">Deployed</option>
      <option value="Retired">Retired</option>
    </select>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Domain</label>
    <select id="filterDomain" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
      <option value="">All</option>
      <option value="Inventory">Inventory</option>
      <option value="Billing">Billing</option>
      <option value="Network Management">Network Management</option>
      <option value="Other">Other</option>
    </select>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Tags</label>
    <input id="filterTags" type="text" placeholder="Comma-separated tags" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Function</label>
    <input id="filterFunction" type="text" placeholder="Function name" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Module</label>
    <input id="filterModule" type="text" placeholder="Module name" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
  </div>
  <div class="mb-4">
    <label class="block font-semibold mb-1">Category</label>
    <input id="filterCategory" type="text" placeholder="Category name" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
  </div>
  <button id="applyFiltersBtn" class="w-full py-2 rounded bg-blue-500 hover:bg-blue-600 text-white font-semibold">Apply Filters</button>
</aside>
<!-- ================= MAIN CONTENT ================= -->
<main class="flex-1 p-4 pt-6 max-w-7xl mx-auto w-full">
  <!-- ============== Capability Map (Grid) ============== -->
  <div id="capabilityGrid" class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 transition-all duration-300"></div>
  <!-- ============== Empty State ============== -->
  <div id="emptyState" class="hidden flex flex-col items-center justify-center py-24 text-gray-400">
    <i class="fa-solid fa-box-open text-6xl mb-4"></i>
    <p class="text-lg">No capabilities found. Click the + button to add one!</p>
  </div>
</main>
<!-- ================= Floating Add Button ================= -->
<button id="addCapabilityBtn" class="fixed bottom-6 right-6 z-40 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg w-16 h-16 flex items-center justify-center text-3xl focus:outline-none">
  <i class="fa-solid fa-plus"></i>
</button>
<!-- ================= Capability Details Modal ================= -->
<div id="capabilityDetailsModal" class="fixed inset-0 z-50 bg-black/40 hidden flex items-center justify-center">
  <div class="relative w-full max-w-2xl mx-2 my-8 bg-white dark:bg-gray-900 rounded-lg shadow-lg flex flex-col max-h-[90vh]">
    <!-- Header -->
    <div class="sticky top-0 flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 rounded-t-lg z-10">
      <h3 id="detailsModalTitle" class="text-xl font-bold">Capability Details</h3>
      <button id="closeDetailsModal" class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-full p-2"><i class="fa-solid fa-xmark text-2xl"></i></button>
    </div>
    <!-- Content -->
    <div id="capabilityDetailsContent" class="overflow-y-auto px-6 py-4 flex-1 space-y-4"></div>
    <!-- Footer (Edit/Delete) -->
    <div class="sticky bottom-0 bg-white dark:bg-gray-900 px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex gap-2 justify-end rounded-b-lg z-10">
      <button id="detailsEditBtn" class="px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold flex items-center gap-2"><i class="fa-solid fa-pen-to-square"></i> Edit</button>
      <button id="detailsDeleteBtn" class="px-4 py-2 rounded bg-red-600 hover:bg-red-700 text-white font-semibold flex items-center gap-2"><i class="fa-solid fa-trash"></i> Delete</button>
    </div>
  </div>
</div>
<!-- ================= Add/Edit Capability Modal ================= -->
<div id="capabilityFormModal" class="fixed inset-0 z-50 bg-black/40 hidden flex items-center justify-center">
  <div class="relative w-full max-w-lg mx-2 my-8 bg-white dark:bg-gray-900 rounded-lg shadow-lg flex flex-col max-h-[90vh]">
    <!-- Header -->
    <div class="sticky top-0 flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 rounded-t-lg z-10">
      <h2 id="formTitle" class="text-xl font-semibold">Add Capability</h2>
      <button id="closeFormModal" class="text-gray-500 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-full p-2"><i class="fa-solid fa-xmark text-2xl"></i></button>
    </div>
    <!-- Content -->
    <form id="capabilityForm" autocomplete="off" class="overflow-y-auto px-6 py-4 flex-1 space-y-4">
      <div>
        <label class="block font-semibold mb-1">Title <span class="text-red-500">*</span></label>
        <input name="title" type="text" required minlength="3" maxlength="100" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
        <div class="text-xs text-gray-400 mt-1">3-100 characters</div>
      </div>
      <div>
        <label class="block font-semibold mb-1">Description <span class="text-red-500">*</span></label>
        <textarea name="description" required minlength="5" maxlength="500" rows="2" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"></textarea>
        <div class="text-xs text-gray-400 mt-1">5-500 characters</div>
      </div>
      <div>
        <label class="block font-semibold mb-1">Status</label>
        <select name="status" required class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
          <option value="Idea">Idea</option>
          <option value="Planned">Planned</option>
          <option value="In Progress">In Progress</option>
          <option value="Deployed">Deployed</option>
          <option value="Retired">Retired</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold mb-1">Domain</label>
        <select name="domain" required class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
          <option value="Inventory">Inventory</option>
          <option value="Billing">Billing</option>
          <option value="Network Management">Network Management</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold mb-1">Function <span class="text-red-500">*</span></label>
        <input name="function" type="text" required maxlength="100" placeholder="e.g. Customer Management" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Module <span class="text-red-500">*</span></label>
        <input name="module" type="text" required maxlength="100" placeholder="e.g. User Profiles" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Category <span class="text-red-500">*</span></label>
        <input name="category" type="text" required maxlength="100" placeholder="e.g. Access Control" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Tags</label>
        <input name="tags" type="text" placeholder="Comma-separated tags" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Owners</label>
        <input name="owners" type="text" placeholder="Business, Technical" class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800"/>
      </div>
      <div>
        <label class="block font-semibold mb-1">Priority</label>
        <select name="priority" required class="w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
          <option value="Low">Low</option>
          <option value="Medium">Medium</option>
          <option value="High">High</option>
        </select>
      </div>
      <button type="submit" class="w-full py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold sticky bottom-0">Save</button>
    </form>
  </div>
</div>
<!-- ================= Toast Notification ================= -->
<div id="toast" class="fixed bottom-24 right-6 z-50 hidden px-4 py-2 rounded bg-gray-800 text-white shadow-lg"></div>
<!-- ================= Data Management Mode Modal ================= -->
<div id="dataModeModal" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center hidden">
  <div class="w-full max-w-md mx-2 my-8 bg-white dark:bg-gray-900 rounded-lg shadow-lg flex flex-col max-h-[90vh]">
    <div class="sticky top-0 flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 rounded-t-lg z-10">
      <h2 class="text-xl font-semibold">Choose Data Management Mode</h2>
    </div>
    <div class="px-6 py-4 flex-1 space-y-4">
      <p class="text-gray-700 dark:text-gray-200">How would you like to manage your Product Catalog data?</p>
      <div id="dataModeError" class="hidden text-red-600 text-sm mb-2"></div>
      <div class="space-y-3">
        <button id="modeLocalStorage" class="w-full py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold">Local Storage (Browser)</button>
        <button id="modeCSV" class="w-full py-2 rounded bg-green-600 hover:bg-green-700 text-white font-semibold">CSV File on Device</button>
        <button id="modeJSON" class="w-full py-2 rounded bg-yellow-600 hover:bg-yellow-700 text-white font-semibold">JSON File on Device</button>
        <button id="modeTXT" class="w-full py-2 rounded bg-gray-600 hover:bg-gray-700 text-white font-semibold">Text File on Device</button>
      </div>
    </div>
  </div>
</div>
<!-- ================= MAIN JS ================= -->
<script>
// =================== DATA MODEL & STORAGE ===================
const STORAGE_KEY = 'product_catalog_capabilities_v1';
let capabilities = [];
let filters = { status: '', domain: '', tags: '', function: '', module: '', category: '' };
let searchQuery = '';
let editingId = null;
let viewMode = localStorage.getItem('catalog_view_mode') || 'card'; // 'card' or 'grid'

// ========== Utility Functions ==========
function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}
function nowISO() {
  return new Date().toISOString();
}
function formatDate(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString() + ' ' + d.toLocaleTimeString();
}
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.remove('hidden');
  setTimeout(() => toast.classList.add('hidden'), 2500);
}
function saveToStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(capabilities));
}
function loadFromStorage() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (data) capabilities = JSON.parse(data);
}

// ========== Data Provider Abstraction ==========
const DataProvider = {
  async load() {
    if (dataMode === 'local') {
      loadFromStorage();
      return capabilities;
    } else if (dataMode === 'csv') {
      if (!fileHandle) return [];
      const file = await fileHandle.getFile();
      const text = await file.text();
      importFromCsv(text);
      return capabilities;
    } else if (dataMode === 'json') {
      if (!fileHandle) return [];
      const file = await fileHandle.getFile();
      const text = await file.text();
      let arr = JSON.parse(text);
      arr = arr.map(obj => ({
        id: obj.id || uuidv4(),
        title: obj.title || '',
        description: obj.description || '',
        status: obj.status || 'Idea',
        domain: obj.domain || '',
        function: obj.function || '',
        module: obj.module || '',
        category: obj.category || '',
        tags: Array.isArray(obj.tags) ? obj.tags : (typeof obj.tags === 'string' && obj.tags ? obj.tags.split('|').map(t=>t.trim()).filter(Boolean) : []),
        owners: Array.isArray(obj.owners) ? obj.owners : (typeof obj.owners === 'string' && obj.owners ? obj.owners.split('|').map(t=>t.trim()).filter(Boolean) : []),
        lastUpdated: obj.lastUpdated || nowISO(),
        priority: obj.priority || 'Medium'
      }));
      capabilities = arr;
      renderGrid();
      renderAnalytics();
      return capabilities;
    } else if (dataMode === 'txt') {
      if (!fileHandle) return [];
      const file = await fileHandle.getFile();
      const text = await file.text();
      // Each line = JSON for a capability
      let arr = text.split('\n').filter(Boolean).map(line => {
        try { return JSON.parse(line); } catch { return null; }
      }).filter(Boolean);
      arr = arr.map(obj => ({
        id: obj.id || uuidv4(),
        title: obj.title || '',
        description: obj.description || '',
        status: obj.status || 'Idea',
        domain: obj.domain || '',
        function: obj.function || '',
        module: obj.module || '',
        category: obj.category || '',
        tags: Array.isArray(obj.tags) ? obj.tags : (typeof obj.tags === 'string' && obj.tags ? obj.tags.split('|').map(t=>t.trim()).filter(Boolean) : []),
        owners: Array.isArray(obj.owners) ? obj.owners : (typeof obj.owners === 'string' && obj.owners ? obj.owners.split('|').map(t=>t.trim()).filter(Boolean) : []),
        lastUpdated: obj.lastUpdated || nowISO(),
        priority: obj.priority || 'Medium'
      }));
      capabilities = arr;
      renderGrid();
      renderAnalytics();
      return capabilities;
    }
  },
  async save() {
    if (dataMode === 'local') {
      saveToStorage();
    } else if (dataMode === 'csv') {
      if (!fileHandle) return;
      const headers = ['id','title','description','status','domain','function','module','category','tags','owners','lastUpdated','priority'];
      let csv = headers.join(',') + '\n';
      for (const cap of capabilities) {
        csv += headers.map(h => {
          let val = cap[h];
          if (Array.isArray(val)) val = val.join('|');
          if (typeof val === 'undefined' || val === null) val = '';
          val = String(val).replace(/"/g,'""').replace(/\n/g,' ');
          return '"'+val+'"';
        }).join(',') + '\n';
      }
      const writable = await fileHandle.createWritable();
      await writable.write(csv);
      await writable.close();
    } else if (dataMode === 'json') {
      if (!fileHandle) return;
      const writable = await fileHandle.createWritable();
      await writable.write(JSON.stringify(capabilities,null,2));
      await writable.close();
    } else if (dataMode === 'txt') {
      if (!fileHandle) return;
      const writable = await fileHandle.createWritable();
      await writable.write(capabilities.map(c => JSON.stringify(c)).join('\n'));
      await writable.close();
    }
  }
};

// ========== Status Badge Color ==========
function statusBadgeColor(status) {
  switch(status) {
    case 'Idea': return 'bg-status-idea text-white';
    case 'Planned': return 'bg-status-planned text-white';
    case 'In Progress': return 'bg-status-inprogress text-white';
    case 'Deployed': return 'bg-status-deployed text-white';
    case 'Retired': return 'bg-status-retired text-gray-900 dark:text-gray-100';
    default: return 'bg-gray-400 text-white';
  }
}
// ========== Priority Color ==========
function priorityColor(priority) {
  switch(priority) {
    case 'High': return 'text-red-600 font-bold';
    case 'Medium': return 'text-yellow-600 font-semibold';
    case 'Low': return 'text-green-600';
    default: return '';
  }
}
// ========== Tag Color ==========
function tagColor(tag) {
  // Simple hash for color
  const colors = ['bg-blue-100 text-blue-700', 'bg-green-100 text-green-700', 'bg-yellow-100 text-yellow-700', 'bg-pink-100 text-pink-700', 'bg-purple-100 text-purple-700', 'bg-gray-200 text-gray-700'];
  let hash = 0;
  for (let i = 0; i < tag.length; i++) hash = tag.charCodeAt(i) + ((hash << 5) - hash);
  return colors[Math.abs(hash) % colors.length];
}
// ========== Group Capabilities by Domain ==========
function groupByDomain(list) {
  const groups = {};
  for (const cap of list) {
    if (!groups[cap.domain]) groups[cap.domain] = [];
    groups[cap.domain].push(cap);
  }
  return groups;
}
// ========== Filter & Search ==========
function filterAndSearch(list) {
  return list.filter(cap => {
    // Status
    if (filters.status && cap.status !== filters.status) return false;
    // Domain
    if (filters.domain && cap.domain !== filters.domain) return false;
    // Tags
    if (filters.tags) {
      const tagsArr = filters.tags.split(',').map(t => t.trim().toLowerCase()).filter(Boolean);
      if (tagsArr.length && !tagsArr.some(tag => cap.tags.map(t => t.toLowerCase()).includes(tag))) return false;
    }
    // Function
    if (filters.function && !cap.function.toLowerCase().includes(filters.function.toLowerCase())) return false;
    // Module
    if (filters.module && !cap.module.toLowerCase().includes(filters.module.toLowerCase())) return false;
    // Category
    if (filters.category && !cap.category.toLowerCase().includes(filters.category.toLowerCase())) return false;
    // Search
    if (searchQuery) {
      const q = searchQuery.toLowerCase();
      if (!cap.title.toLowerCase().includes(q)
        && !cap.tags.join(',').toLowerCase().includes(q)
        && !cap.owners.join(',').toLowerCase().includes(q)
        && !cap.function.toLowerCase().includes(q)
        && !cap.module.toLowerCase().includes(q)
        && !cap.category.toLowerCase().includes(q)) return false;
    }
    return true;
  });
}
// =================== RENDER FUNCTIONS ===================
function renderAnalytics() {
  const statusList = ['Idea','Planned','In Progress','Deployed','Retired'];
  const counts = {};
  for (const s of statusList) counts[s] = 0;
  for (const cap of capabilities) counts[cap.status]++;
  let html = '';
  for (const s of statusList) {
    html += `<span class="inline-flex items-center gap-1 px-2 py-1 rounded ${statusBadgeColor(s)} text-xs font-semibold">${s}: ${counts[s]}</span>`;
  }
  document.getElementById('analyticsSection').innerHTML = html;
}
function renderGrid() {
  const grid = document.getElementById('capabilityGrid');
  const empty = document.getElementById('emptyState');
  const filtered = filterAndSearch(capabilities);
  if (!filtered.length) {
    grid.innerHTML = '';
    empty.classList.remove('hidden');
    return;
  }
  empty.classList.add('hidden');
  const grouped = groupByDomain(filtered);
  let html = '';
  if (viewMode === 'grid') {
    // Grid View: compact tiles
    html += '<div class="col-span-full w-full overflow-x-auto"><table class="min-w-full text-sm text-left"><thead><tr class="bg-gray-100 dark:bg-gray-700">'
      + '<th class="p-2">Title</th>'
      + '<th class="p-2">Status</th>'
      + '<th class="p-2">Domain</th>'
      + '<th class="p-2">Function</th>'
      + '<th class="p-2">Module</th>'
      + '<th class="p-2">Category</th>'
      + '<th class="p-2">Tags</th>'
      + '<th class="p-2">Owners</th>'
      + '<th class="p-2">Priority</th>'
      + '<th class="p-2">Actions</th>'
      + '</tr></thead><tbody>';
    for (const domain in grouped) {
      for (const cap of grouped[domain]) {
        html += renderGridRow(cap);
      }
    }
    html += '</tbody></table></div>';
    grid.className = 'block transition-all duration-300';
  } else {
    // Card View
    for (const domain in grouped) {
      html += `<div class="col-span-full mt-6 mb-1 flex items-center gap-2"><span class="font-bold text-lg">${domain}</span></div>`;
      for (const cap of grouped[domain]) {
        html += renderCard(cap);
      }
    }
    grid.className = 'grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 transition-all duration-300';
  }
  grid.innerHTML = html;
  // Animate cards on load
  if (viewMode === 'card') {
    setTimeout(() => {
      document.querySelectorAll('.cap-anim').forEach((el, i) => {
        el.classList.remove('opacity-0','translate-y-4');
        el.classList.add('opacity-100','translate-y-0');
      });
    }, 10);
  }
}
// <!-- Capability Card -->
function renderCard(cap) {
  return `<div class="bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-2xl transition-all duration-300 p-4 flex flex-col gap-2 cursor-pointer group relative border border-gray-100 dark:border-gray-700 cap-anim opacity-0 translate-y-4 hover:scale-[1.025] hover:-translate-y-1" onclick="showDetails('${cap.id}')">
    <div class="flex items-center justify-between">
      <span class="font-semibold text-lg">${cap.title}</span>
      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded ${statusBadgeColor(cap.status)} text-xs font-semibold">${cap.status}</span>
    </div>
    <div class="text-xs text-gray-500 mb-1">${cap.function} &gt; ${cap.module} &gt; ${cap.category}</div>
    <div class="flex flex-wrap gap-1 mb-2">${cap.tags.map(tag => `<span class="px-2 py-0.5 rounded ${tagColor(tag)} text-xs">${tag}</span>`).join('')}</div>
    <div class="flex items-center gap-2 text-xs text-gray-500">
      <span><i class="fa-solid fa-user"></i> ${cap.owners.join(', ')}</span>
      <span><i class="fa-solid fa-clock"></i> ${formatDate(cap.lastUpdated)}</span>
    </div>
    <div class="flex items-center gap-2 mt-2">
      <span class="${priorityColor(cap.priority)} text-xs">${cap.priority} Priority</span>
    </div>
    <div class="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition">
      <button onclick="event.stopPropagation();editCapability('${cap.id}')" class="p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900"><i class="fa-solid fa-pen-to-square text-blue-600"></i></button>
      <button onclick="event.stopPropagation();deleteCapability('${cap.id}')" class="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900"><i class="fa-solid fa-trash text-red-600"></i></button>
    </div>
  </div>`;
}
// <!-- Grid View Row -->
function renderGridRow(cap) {
  return `<tr class="bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700 hover:bg-blue-50 dark:hover:bg-blue-900 transition-all duration-200">
    <td class="p-2 cursor-pointer font-semibold" onclick="showDetails('${cap.id}')">${cap.title}</td>
    <td class="p-2"><span class="inline-flex items-center gap-1 px-2 py-0.5 rounded ${statusBadgeColor(cap.status)} text-xs font-semibold">${cap.status}</span></td>
    <td class="p-2">${cap.domain}</td>
    <td class="p-2">${cap.function}</td>
    <td class="p-2">${cap.module}</td>
    <td class="p-2">${cap.category}</td>
    <td class="p-2">${cap.tags.map(tag => `<span class="px-2 py-0.5 rounded ${tagColor(tag)} text-xs">${tag}</span>`).join('')}</td>
    <td class="p-2">${cap.owners.join(', ')}</td>
    <td class="p-2"><span class="${priorityColor(cap.priority)} text-xs">${cap.priority}</span></td>
    <td class="p-2 flex gap-1">
      <button onclick="event.stopPropagation();editCapability('${cap.id}')" class="p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900"><i class="fa-solid fa-pen-to-square text-blue-600"></i></button>
      <button onclick="event.stopPropagation();deleteCapability('${cap.id}')" class="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900"><i class="fa-solid fa-trash text-red-600"></i></button>
    </td>
  </tr>`;
}
// =================== CRUD LOGIC ===================
function addCapability(cap) {
  capabilities.push(cap);
  DataProvider.save();
  renderGrid();
  renderAnalytics();
  showToast('Capability added!');
}
function updateCapability(id, updated) {
  const idx = capabilities.findIndex(c => c.id === id);
  if (idx > -1) {
    capabilities[idx] = { ...capabilities[idx], ...updated, lastUpdated: nowISO() };
    DataProvider.save();
    renderGrid();
    renderAnalytics();
    showToast('Capability updated!');
  }
}
function removeCapability(id) {
  capabilities = capabilities.filter(c => c.id !== id);
  DataProvider.save();
  renderGrid();
  renderAnalytics();
  showToast('Capability deleted!');
}
// =================== MODAL HANDLING ===================
function showFormModal(editingCap = null) {
  document.getElementById('capabilityFormModal').classList.remove('hidden');
  document.body.classList.add('overflow-hidden');
  const form = document.getElementById('capabilityForm');
  form.reset();
  editingId = null;
  document.getElementById('formTitle').textContent = editingCap ? 'Edit Capability' : 'Add Capability';
  if (editingCap) {
    editingId = editingCap.id;
    form.title.value = editingCap.title;
    form.description.value = editingCap.description;
    form.status.value = editingCap.status;
    form.domain.value = editingCap.domain;
    form.function.value = editingCap.function;
    form.module.value = editingCap.module;
    form.category.value = editingCap.category;
    form.tags.value = editingCap.tags.join(', ');
    form.owners.value = editingCap.owners.join(', ');
    form.priority.value = editingCap.priority;
  }
  // Focus the first input
  setTimeout(() => { form.querySelector('input,textarea,select')?.focus(); }, 100);
}
function closeFormModal() {
  document.getElementById('capabilityFormModal').classList.add('hidden');
  document.body.classList.remove('overflow-hidden');
  editingId = null;
}
function showDetails(id) {
  const cap = capabilities.find(c => c.id === id);
  if (!cap) return;
  document.getElementById('capabilityDetailsModal').classList.remove('hidden');
  document.body.classList.add('overflow-hidden');
  // Render all details with nice formatting
  document.getElementById('capabilityDetailsContent').innerHTML = `
    <div class="space-y-2">
      <div class="flex flex-wrap gap-2 items-center">
        <span class="text-2xl font-bold">${cap.title}</span>
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded ${statusBadgeColor(cap.status)} text-xs font-semibold">${cap.status}</span>
      </div>
      <div class="text-sm text-gray-500 mb-2"><b>Hierarchy:</b> ${cap.function} &gt; ${cap.module} &gt; ${cap.category}</div>
      <div class="mb-2 text-gray-700 dark:text-gray-200 whitespace-pre-line"><b>Description:</b> ${cap.description}</div>
      <div class="flex flex-wrap gap-1 mb-2"><b>Tags:</b> ${cap.tags.map(tag => `<span class="px-2 py-0.5 rounded ${tagColor(tag)} text-xs">${tag}</span>`).join('')}</div>
      <div class="flex flex-wrap gap-2 text-sm mb-2">
        <span><b>Domain:</b> ${cap.domain}</span>
        <span><b>Priority:</b> <span class="${priorityColor(cap.priority)}">${cap.priority}</span></span>
      </div>
      <div class="flex flex-wrap gap-2 text-sm mb-2">
        <span><b>Owners:</b> ${cap.owners.join(', ')}</span>
      </div>
      <div class="text-xs text-gray-500 mb-2">Last updated: ${formatDate(cap.lastUpdated)}</div>
    </div>
  `;
  // Setup Edit/Delete buttons
  setTimeout(() => {
    document.getElementById('detailsEditBtn').onclick = () => editCapability(id);
    document.getElementById('detailsDeleteBtn').onclick = () => deleteCapability(id);
  }, 0);
}
function closeDetailsModal() {
  document.getElementById('capabilityDetailsModal').classList.add('hidden');
  document.body.classList.remove('overflow-hidden');
}
// Allow closing modals by clicking overlay
[...document.querySelectorAll('#capabilityFormModal, #capabilityDetailsModal')].forEach(modal => {
  modal.addEventListener('mousedown', e => {
    if (e.target === modal) {
      modal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }
  });
});
// Trap focus inside modal for accessibility
function trapFocus(modalId) {
  const modal = document.getElementById(modalId);
  const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
  const first = focusable[0];
  const last = focusable[focusable.length - 1];
  modal.addEventListener('keydown', e => {
    if (e.key === 'Tab') {
      if (e.shiftKey) {
        if (document.activeElement === first) {
          e.preventDefault();
          last.focus();
        }
      } else {
        if (document.activeElement === last) {
          e.preventDefault();
          first.focus();
        }
      }
    }
    if (e.key === 'Escape') {
      modal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }
  });
}
trapFocus('capabilityFormModal');
trapFocus('capabilityDetailsModal');
// =================== FORM SUBMISSION ===================
document.getElementById('capabilityForm').onsubmit = function(e) {
  e.preventDefault();
  const form = e.target;
  const cap = {
    id: editingId || uuidv4(),
    title: form.title.value.trim(),
    description: form.description.value.trim(),
    status: form.status.value,
    domain: form.domain.value,
    function: form.function.value.trim(),
    module: form.module.value.trim(),
    category: form.category.value.trim(),
    tags: form.tags.value.split(',').map(t => t.trim()).filter(Boolean),
    owners: form.owners.value.split(',').map(t => t.trim()).filter(Boolean),
    lastUpdated: nowISO(),
    priority: form.priority.value
  };
  if (!cap.title || !cap.description || !cap.function || !cap.module || !cap.category) {
    showToast('Title, Description, Function, Module, and Category are required.');
    return;
  }
  if (editingId) {
    updateCapability(editingId, cap);
  } else {
    addCapability(cap);
  }
  closeFormModal();
};
// =================== EVENT LISTENERS ===================
document.getElementById('addCapabilityBtn').onclick = () => showFormModal();
document.getElementById('closeFormModal').onclick = closeFormModal;
document.getElementById('closeDetailsModal').onclick = closeDetailsModal;
document.getElementById('filterPanelToggle').onclick = () => {
  document.getElementById('filterPanel').classList.remove('-translate-x-full');
};
document.getElementById('closeFilterPanel').onclick = () => {
  document.getElementById('filterPanel').classList.add('-translate-x-full');
};
document.getElementById('applyFiltersBtn').onclick = () => {
  filters.status = document.getElementById('filterStatus').value;
  filters.domain = document.getElementById('filterDomain').value;
  filters.tags = document.getElementById('filterTags').value;
  filters.function = document.getElementById('filterFunction').value;
  filters.module = document.getElementById('filterModule').value;
  filters.category = document.getElementById('filterCategory').value;
  renderGrid();
  document.getElementById('filterPanel').classList.add('-translate-x-full');
};
document.getElementById('searchInput').oninput = (e) => {
  searchQuery = e.target.value;
  renderGrid();
};
// ========== Theme Toggle ==========
function setTheme(dark) {
  const html = document.documentElement;
  if (dark) {
    html.classList.add('dark');
    localStorage.setItem('theme','dark');
    document.getElementById('themeIcon').className = 'fa-solid fa-sun';
  } else {
    html.classList.remove('dark');
    localStorage.setItem('theme','light');
    document.getElementById('themeIcon').className = 'fa-regular fa-moon';
  }
}
document.getElementById('themeToggleBtn').onclick = () => {
  const dark = !document.documentElement.classList.contains('dark');
  setTheme(dark);
};
(function initTheme() {
  const saved = localStorage.getItem('theme');
  setTheme(saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches));
})();
// ========== Export/Import CSV ==========
document.getElementById('exportCsvBtn').onclick = () => {
  const headers = ['id','title','description','status','domain','function','module','category','tags','owners','lastUpdated','priority'];
  let csv = headers.join(',') + '\n';
  for (const cap of capabilities) {
    csv += headers.map(h => {
      let val = cap[h];
      if (Array.isArray(val)) val = val.join('|');
      if (typeof val === 'undefined' || val === null) val = '';
      val = String(val).replace(/"/g,'""').replace(/\n/g,' ');
      return '"'+val+'"';
    }).join(',') + '\n';
  }
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'product_catalog.csv';
  a.click();
  URL.revokeObjectURL(url);
};
// ========== Import CSV (robust) ==========
document.getElementById('importCsvBtn').onclick = () => {
  document.getElementById('hiddenFileInput').accept = '.csv';
  document.getElementById('hiddenFileInput').click();
};
function importFromCsv(text) {
  const lines = text.split(/\r?\n/).filter(Boolean);
  if (lines.length < 2) return showToast('CSV file is empty!');
  const headers = lines[0].split(',').map(h => h.replace(/"/g,'').trim());
  const arr = [];
  for (let i = 1; i < lines.length; i++) {
    const values = parseCsvLine(lines[i]);
    if (values.length !== headers.length) continue;
    const obj = {};
    for (let j = 0; j < headers.length; j++) {
      let val = values[j] ? values[j].replace(/"/g,'').trim() : '';
      obj[headers[j]] = val;
    }
    // Robust mapping and defaults
    arr.push({
      id: obj.id || uuidv4(),
      title: obj.title || '',
      description: obj.description || '',
      status: obj.status || 'Idea',
      domain: obj.domain || '',
      function: obj.function || '',
      module: obj.module || '',
      category: obj.category || '',
      tags: obj.tags ? obj.tags.split('|').map(t=>t.trim()).filter(Boolean) : [],
      owners: obj.owners ? obj.owners.split('|').map(t=>t.trim()).filter(Boolean) : [],
      lastUpdated: obj.lastUpdated || nowISO(),
      priority: obj.priority || 'Medium'
    });
  }
  capabilities = arr;
  DataProvider.save();
  renderGrid();
  renderAnalytics();
  showToast('Imported CSV!');
}
function parseCsvLine(line) {
  // Handles quoted fields, commas, etc.
  const result = [];
  let cur = '', inQuotes = false;
  for (let i = 0; i < line.length; i++) {
    const c = line[i];
    if (c === '"') {
      if (inQuotes && line[i+1] === '"') { cur += '"'; i++; }
      else inQuotes = !inQuotes;
    } else if (c === ',' && !inQuotes) {
      result.push(cur); cur = '';
    } else {
      cur += c;
    }
  }
  result.push(cur);
  return result;
}
// ========== Export/Import JSON (robust) ==========
document.getElementById('exportJsonBtn').onclick = () => {
  const blob = new Blob([JSON.stringify(capabilities,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'product_catalog.json';
  a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('importJsonBtn').onclick = () => {
  document.getElementById('hiddenFileInput').accept = '.json';
  document.getElementById('hiddenFileInput').click();
};
document.getElementById('hiddenFileInput').onchange = function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const isJson = file.name.endsWith('.json');
  const isCsv = file.name.endsWith('.csv');
  const reader = new FileReader();
  reader.onload = function(evt) {
    try {
      if (isJson) {
        let arr = JSON.parse(evt.target.result);
        if (!Array.isArray(arr)) throw new Error('Invalid JSON format');
        // Robust migration/validation
        arr = arr.map(obj => ({
          id: obj.id || uuidv4(),
          title: obj.title || '',
          description: obj.description || '',
          status: obj.status || 'Idea',
          domain: obj.domain || '',
          function: obj.function || '',
          module: obj.module || '',
          category: obj.category || '',
          tags: Array.isArray(obj.tags) ? obj.tags : (typeof obj.tags === 'string' && obj.tags ? obj.tags.split('|').map(t=>t.trim()).filter(Boolean) : []),
          owners: Array.isArray(obj.owners) ? obj.owners : (typeof obj.owners === 'string' && obj.owners ? obj.owners.split('|').map(t=>t.trim()).filter(Boolean) : []),
          lastUpdated: obj.lastUpdated || nowISO(),
          priority: obj.priority || 'Medium'
        }));
        capabilities = arr;
        DataProvider.save();
        renderGrid();
        renderAnalytics();
        showToast('Imported JSON!');
      } else if (isCsv) {
        importFromCsv(evt.target.result);
      }
    } catch (err) {
      showToast('Import failed: ' + err.message);
    }
  };
  reader.readAsText(file);
  e.target.value = '';
};
// =================== VIEW TOGGLE ===================
document.getElementById('viewToggleBtn').onclick = () => {
  viewMode = (viewMode === 'card') ? 'grid' : 'card';
  localStorage.setItem('catalog_view_mode', viewMode);
  updateViewToggleBtn();
  renderGrid();
};
function updateViewToggleBtn() {
  const icon = document.getElementById('viewToggleIcon');
  const text = document.getElementById('viewToggleText');
  if (viewMode === 'card') {
    icon.className = 'fa-solid fa-table-cells';
    text.textContent = 'Grid View';
  } else {
    icon.className = 'fa-solid fa-address-card';
    text.textContent = 'Card View';
  }
}
// =================== INIT ===================
(function init() {
  DataProvider.load();
  updateViewToggleBtn();
  renderGrid();
  renderAnalytics();
})();

// ========== Edit/Delete from Card or Modal ==========
function editCapability(id) {
  const cap = capabilities.find(c => c.id === id);
  if (!cap) return;
  closeDetailsModal();
  showFormModal(cap);
}
function deleteCapability(id) {
  if (!confirm('Are you sure you want to delete this capability?')) return;
  closeDetailsModal();
  removeCapability(id);
}
// Patch quick action buttons in cards/grid to use new handlers
window.editCapability = editCapability;
window.deleteCapability = deleteCapability;

// =================== DATA MODE ABSTRACTION ===================
const DATA_MODE_KEY = 'product_catalog_data_mode';
const DATA_FILE_HANDLE_KEY = 'product_catalog_file_handle';
let dataMode = localStorage.getItem(DATA_MODE_KEY) || null; // 'local','csv','json','txt'
let fileHandle = null;
let folderHandle = null;

async function pickFileOrFolder(type) {
  if ('showDirectoryPicker' in window && type === 'folder') {
    folderHandle = await window.showDirectoryPicker();
    return folderHandle;
  } else if ('showSaveFilePicker' in window && (type === 'csv' || type === 'json' || type === 'txt')) {
    let suggestedName = 'product_catalog.' + type;
    fileHandle = await window.showSaveFilePicker({
      suggestedName,
      types: [{
        description: type.toUpperCase() + ' File',
        accept: { ['text/' + (type==='txt'?'plain':type)]: ['.'+type] }
      }]
    });
    return fileHandle;
  } else {
    alert('Your browser does not support direct file/folder access. Please use Local Storage mode or Import/Export.');
    return null;
  }
}

// ========== Data Mode Modal Logic ==========
function attachDataModeListeners() {
  ['modeLocalStorage','modeCSV','modeJSON','modeTXT'].forEach(id => {
    const btn = document.getElementById(id);
    if (btn) btn.onclick = () => selectDataMode(id.replace('mode','').toLowerCase());
  });
}
function attachChangeDataModeBtnListener() {
  const btn = document.getElementById('changeDataModeBtn');
  if (btn) btn.onclick = () => showDataModeModal();
}
function showDataModeModal() {
  const modal = document.getElementById('dataModeModal');
  if (modal) {
    modal.classList.remove('hidden');
    document.body.classList.add('overflow-hidden');
    attachDataModeListeners();
    console.log('[Modal] Data mode modal shown');
  }
}
function closeDataModeModal() {
  const modal = document.getElementById('dataModeModal');
  if (modal) {
    modal.classList.add('hidden');
    document.body.classList.remove('overflow-hidden');
    console.log('[Modal] Data mode modal closed');
  }
}
function showDataModeError(msg) {
  const errDiv = document.getElementById('dataModeError');
  if (errDiv) {
    errDiv.textContent = msg;
    errDiv.classList.remove('hidden');
    console.error('[Modal] ERROR:', msg);
  }
}
async function pickFileOrFolder(type) {
  if ('showSaveFilePicker' in window && (type === 'csv' || type === 'json' || type === 'txt')) {
    let suggestedName = 'product_catalog.' + type;
    try {
      const handle = await window.showSaveFilePicker({
        suggestedName,
        types: [{
          description: type.toUpperCase() + ' File',
          accept: { ['text/' + (type==='txt'?'plain':type)]: ['.'+type] }
        }]
      });
      console.log('[FilePicker] Got file handle:', handle);
      return handle;
    } catch (err) {
      console.error('[FilePicker] File picker cancelled or failed:', err);
      return null;
    }
  } else {
    showDataModeError('File access not supported in this browser. Using Local Storage.');
    return null;
  }
}
async function selectDataMode(mode) {
  const prevMode = dataMode;
  const prevFileHandle = fileHandle;
  let newMode = mode;
  let newFileHandle = null;
  if (newMode === 'csv' || newMode === 'json' || newMode === 'txt') {
    newFileHandle = await pickFileOrFolder(newMode);
    if (!newFileHandle) {
      // Cancelled: keep previous mode and fileHandle
      showDataModeError('Cancelled. Keeping previous data mode.');
      closeDataModeModal();
      updateDataModeIndicator();
      showToast('Data mode unchanged.');
      return;
    }
  }
  // Only update if not cancelled
  dataMode = newMode;
  fileHandle = newFileHandle;
  localStorage.setItem(DATA_MODE_KEY, dataMode);
  closeDataModeModal();
  await DataProvider.load();
  renderGrid();
  renderAnalytics();
  updateDataModeIndicator();
  showToast('Data mode set: ' + (dataMode === 'local' ? 'Local Storage' : dataMode.toUpperCase() + ' File'));
}

function updateDataModeIndicator() {
  const indicator = document.getElementById('dataModeIndicator');
  let label = 'Unknown';
  const mode = (dataMode || '').toLowerCase();
  if (mode === 'local' || mode === 'localstorage' || mode === 'local-storage') label = 'Local Storage';
  else if (mode === 'csv') label = 'CSV File';
  else if (mode === 'json') label = 'JSON File';
  else if (mode === 'txt' || mode === 'text') label = 'Text File';
  indicator.textContent = 'Mode: ' + label;
}

// Patch initialization logic to update the indicator correctly.
window.addEventListener('DOMContentLoaded', async () => {
  try {
    attachChangeDataModeBtnListener();
    attachDataModeListeners();
    dataMode = localStorage.getItem(DATA_MODE_KEY) || null;
    if (!dataMode || ((dataMode === 'csv' || dataMode === 'json' || dataMode === 'txt') && !fileHandle)) {
      setTimeout(showDataModeModal, 300);
      updateDataModeIndicator();
      return;
    }
    await DataProvider.load();
    renderGrid();
    renderAnalytics();
    updateDataModeIndicator();
  } catch (err) {
    showDataModeError('Initialization error: ' + (err.message || err));
    console.error('Modal startup error:', err);
  }
});
</script>
</body>
</html>
